<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Expense Tracker</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial,sans-serif;margin:20px;background:#f5f5f5;color:#333;}
h1,h2,h3{margin-bottom:10px;}
.container{max-width:1200px;margin:auto;}
.summary-cards{display:flex;gap:1rem;margin-bottom:20px;}
.card{background:#fff;padding:15px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,0.1);flex:1;text-align:center;}
table{width:100%;border-collapse:collapse;margin-bottom:20px;}
th,td{padding:10px;border-bottom:1px solid #ccc;text-align:left;}
th{background:#eee;}
button{padding:5px 10px;margin-right:5px;border:none;border-radius:4px;cursor:pointer;}
button.edit{background:#4caf50;color:#fff;}
button.delete{background:#f44336;color:#fff;}
.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none;transition:0.3s;}
.modal.show{opacity:1;pointer-events:auto;}
.modal-content{background:#fff;padding:20px;border-radius:8px;width:400px;}
.modal-content input, .modal-content select{width:100%;padding:8px;margin-bottom:10px;border:1px solid #ccc;border-radius:4px;}
.modal-content button{width:48%;}
</style>
</head>
<body>
<div class="container">
<h1>Expense Tracker</h1>
<button onclick="showModal()">Add Expense</button>

<div class="summary-cards" id="summaryCards"></div>

<h2>All Expenses</h2>
<table>
<thead>
<tr>
<th>Date</th>
<th>Note</th>
<th>Category</th>
<th>Amount</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="expenseTable"></tbody>
</table>

<h2>Charts</h2>
<canvas id="categoryChart" height="200"></canvas>
<canvas id="monthlyChart" height="200"></canvas>
</div>

<!-- Modal -->
<div class="modal" id="expenseModal">
<div class="modal-content">
<h3 id="modalTitle">Add Expense</h3>
<input type="hidden" id="expenseId">
<label>Date</label>
<input type="date" id="expenseDate">
<label>Note</label>
<input type="text" id="expenseNote">
<label>Category</label>
<select id="expenseCategory">
<option value="Food">Food</option>
<option value="Travel">Travel</option>
<option value="Bills">Bills</option>
<option value="Shopping">Shopping</option>
<option value="Entertainment">Entertainment</option>
<option value="Other">Other</option>
</select>
<label>Amount</label>
<input type="number" id="expenseAmount" step="0.01">
<div style="display:flex;justify-content:space-between;">
<button onclick="hideModal()">Cancel</button>
<button onclick="saveExpense()">Save</button>
</div>
</div>
</div>

<script>
const apiUrl="http://localhost:8080/api/expenses"; // backend endpoint
let categoryChart, monthlyChart;

// Show modal
function showModal(){document.getElementById('expenseModal').classList.add('show');document.getElementById('modalTitle').innerText='Add Expense';resetModal();}
function hideModal(){document.getElementById('expenseModal').classList.remove('show');resetModal();}
function resetModal(){document.getElementById('expenseId').value='';document.getElementById('expenseDate').value='';document.getElementById('expenseNote').value='';document.getElementById('expenseCategory').value='Food';document.getElementById('expenseAmount').value='';}

// Fetch and render expenses
async function getExpenses(){
const res=await fetch(apiUrl);
const expenses=await res.json();
renderTable(expenses);
renderSummary(expenses);
renderCharts(expenses);
}

// Table
function renderTable(expenses){
const tbody=document.getElementById('expenseTable');
tbody.innerHTML='';
expenses.forEach(e=>{
tbody.innerHTML+=`<tr>
<td>${e.date}</td>
<td>${e.note}</td>
<td>${e.category}</td>
<td>₹${e.amount.toFixed(2)}</td>
<td>
<button class="edit" onclick="editExpense(${e.id})">Edit</button>
<button class="delete" onclick="deleteExpense(${e.id})">Delete</button>
</td>
</tr>`;
});
}

// Summary
function renderSummary(expenses){
const total=expenses.reduce((a,b)=>a+b.amount,0);
const byCategory={};
const byMonth={};
expenses.forEach(e=>{
byCategory[e.category]=(byCategory[e.category]||0)+e.amount;
const month=new Date(e.date).toLocaleString('default',{month:'short',year:'numeric'});
byMonth[month]=(byMonth[month]||0)+e.amount;
});
const container=document.getElementById('summaryCards');
container.innerHTML='';
container.innerHTML+=`<div class="card"><h3>Total Spent</h3><p>₹${total.toFixed(2)}</p></div>`;
for(let cat in byCategory){
container.innerHTML+=`<div class="card"><h3>${cat}</h3><p>₹${byCategory[cat].toFixed(2)}</p></div>`;
}
}

// Charts
function renderCharts(expenses){
const byCategory={};
const byMonth={};
expenses.forEach(e=>{
byCategory[e.category]=(byCategory[e.category]||0)+e.amount;
const month=new Date(e.date).toLocaleString('default',{month:'short',year:'numeric'});
byMonth[month]=(byMonth[month]||0)+e.amount;
});

// Category chart
const ctxCat=document.getElementById('categoryChart').getContext('2d');
if(categoryChart) categoryChart.destroy();
categoryChart=new Chart(ctxCat,{type:'pie',data:{labels:Object.keys(byCategory),datasets:[{label:'Amount',data:Object.values(byCategory),backgroundColor:['#f44336','#2196f3','#ff9800','#4caf50','#9c27b0','#00bcd4']}]}});

// Monthly chart
const ctxMon=document.getElementById('monthlyChart').getContext('2d');
if(monthlyChart) monthlyChart.destroy();
monthlyChart=new Chart(ctxMon,{type:'bar',data:{labels:Object.keys(byMonth),datasets:[{label:'Amount',data:Object.values(byMonth),backgroundColor:'#2196f3'}]}});
}

// Save expense
async function saveExpense(){
const id=document.getElementById('expenseId').value;
const expense={
date:document.getElementById('expenseDate').value,
note:document.getElementById('expenseNote').value,
category:document.getElementById('expenseCategory').value,
amount:parseFloat(document.getElementById('expenseAmount').value)
};
if(!expense.date||!expense.note||!expense.amount){alert('Fill all fields');return;}
if(id){await fetch(`${apiUrl}/${id}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(expense)});}
else{await fetch(apiUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(expense)});}
hideModal();
getExpenses();
}

// Edit
async function editExpense(id){
const res=await fetch(`${apiUrl}/${id}`);
const e=await res.json();
document.getElementById('expenseId').value=e.id;
document.getElementById('expenseDate').value=e.date;
document.getElementById('expenseNote').value=e.note;
document.getElementById('expenseCategory').value=e.category;
document.getElementById('expenseAmount').value=e.amount;
document.getElementById('modalTitle').innerText='Edit Expense';
showModal();
}

// Delete
async function deleteExpense(id){
if(confirm('Delete this expense?')){await fetch(`${apiUrl}/${id}`,{method:'DELETE'});getExpenses();}
}

getExpenses();
</script>
</body>
</html>
